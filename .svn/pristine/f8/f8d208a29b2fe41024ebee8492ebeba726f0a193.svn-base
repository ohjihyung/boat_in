<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core"  prefix="c"%>
<!-- Topbar Start -->
<script type="text/javascript">
memberId = localStorage.getItem('id')
	if (memberId == null || memberId == "") {
		alert("ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ ì…ë‹ˆë‹¤.")
		location.href = '/login'
	}
</script>
<style>
#widget-memo {
    background: #FBF9C6;
}
#memoTextArea {
    width: 100%;
    height: 140px;
    overflow: auto;
    background-color: #FBF9C6;
    color: black;
    border: none;
}
#memoTextArea:focus {
    outline: none;
}

.cal-container {
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
}
.calculator {
  background-color: #06597a;
  width: 350px;
  height: 500px;
  border-radius: 10px;
  padding: 10px 20px;
  border: solid 6px #ffffff;
}
.calculator__display--for-advanced {
  background-color: #f09393;
  height: 100px;
  width: 100%;
  border-radius: 10px;
  font-size: 30px;
  text-align: center;
  vertical-align: middle;
  padding: 25px 15px;
  overflow: hidden;
  overflow-wrap: break-word;
}
.calculator__buttons {
  background-color: #ffffff;
  width: 100%;
  height: 330px;
  margin-top: 10px;
  padding: 10px;
  border-radius: 10px;
  font-size: 25px;
}
.clear__and__enter {
  text-align: center;
  height: 50px;
  margin: 10px;
  border-radius: 10px;
  background-color: #ffffff;
}
.clear__and__enter > button {
  border-radius: 10px;
  width: 125px;
  height: 50px;
  margin: 0px 0px;
  background-color: #f09393; 
  cursor: pointer;
  outline: none;
  border: 0px solid #30bb98;
}
.button__row {
  border-radius: 10px;
  text-align: center;
  height: 50px;
  margin: 10px;
  background-color: #ffffff;
}
.button__row > button {
  width: 60px;
  height: 50px;
  border-radius: 10px;
  cursor: pointer;
  outline: none;
  background-color: #bdb2b2;
}
.button__row > .operator {
  color: #ffffff;
  background-color: #313132;
}
.button__row > .double {
  width: 125px;
}
.button__row > .isPressed {
  background-color: #00da75;
}

</style>
<div class="navbar-custom">
    <div class="container-fluid">
        <ul class="list-unstyled topnav-menu float-end mb-0">

            <li class="d-none d-lg-block">
                <form class="app-search">
                    <div class="app-search-box dropdown">
                        <div class="input-group">
                            <input type="search" class="form-control" placeholder="Search..." id="top-search">
                            <button class="btn input-group-text" type="submit">
                                <i class="fe-search"></i>
                            </button>
                        </div>
                        <div class="dropdown-menu dropdown-lg" id="search-dropdown">
                            <!-- item-->
                            <div class="dropdown-header noti-title">
                                <h6 class="text-overflow text-uppercase">Recent Searches</h6>
                            </div>

                            <div class="g-3 px-2 pb-2">
                                <a href="#!" class="btn btn-sm rounded-pill btn-light">profile <i class="fe-search ms-1"></i></a>
                                <a href="#!" class="btn btn-sm rounded-pill btn-light">yarn <i class="fe-search ms-1"></i></a>
                            </div>
            
                            <!-- item-->
                            <a href="javascript:void(0);" class="dropdown-item notify-item">
                                <i class="fe-home me-1"></i>
                                <span>Analytics Report</span>
                            </a>
            
                            <!-- item-->
                            <a href="javascript:void(0);" class="dropdown-item notify-item">
                                <i class="fe-aperture me-1"></i>
                                <span>How can I help you?</span>
                            </a>
                            
                            <!-- item-->
                            <a href="javascript:void(0);" class="dropdown-item notify-item">
                                <i class="fe-settings me-1"></i>
                                <span>User profile settings</span>
                            </a>

                            <!-- item-->
                            <div class="dropdown-header noti-title">
                                <h6 class="text-overflow mb-2 text-uppercase">Users</h6>
                            </div>

                            <div class="notification-list">
                                <!-- item-->
                                <a href="javascript:void(0);" class="dropdown-item notify-item">
                                    <div class="d-flex align-items-start">
                                        <img class="d-flex me-2 rounded-circle" src="${pageContext.request.contextPath }/resources/dist/assets/images/users/user-2.jpg" alt="Generic placeholder image" height="32">
                                        <div class="w-100">
                                            <h5 class="m-0 font-14">Erwin E. Brown</h5>
                                            <span class="font-12 mb-0">UI Designer</span>
                                        </div>
                                    </div>
                                </a>

                                <!-- item-->
                                <a href="javascript:void(0);" class="dropdown-item notify-item">
                                    <div class="d-flex align-items-start">
                                        <img class="d-flex me-2 rounded-circle" src="${pageContext.request.contextPath }/resources/dist/assets/images/users/user-5.jpg" alt="Generic placeholder image" height="32">
                                        <div class="w-100">
                                            <h5 class="m-0 font-14">Jacob Deo</h5>
                                            <span class="font-12 mb-0">Developer</span>
                                        </div>
                                    </div>
                                </a>
                            </div>
            
                        </div>  
                    </div>
                </form>
            </li>
    
            <li class="dropdown d-inline-block d-lg-none">
                <a class="nav-link dropdown-toggle arrow-none waves-effect waves-light" data-bs-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
                    <i class="fe-search noti-icon"></i>
                </a>
                <div class="dropdown-menu dropdown-lg dropdown-menu-end p-0">
                    <form class="p-3">
                        <input type="text" class="form-control" placeholder="Search ..." aria-label="Recipient's username">
                    </form>
                </div>
            </li>
    
            <li class="dropdown d-none d-lg-inline-block">
                <a class="nav-link dropdown-toggle arrow-none waves-effect waves-light" data-toggle="fullscreen" href="#">
                    <i class="fe-maximize noti-icon"></i>
                </a>
            </li>
            
            <li class="dropdown block">
                <a class="nav-link dropdown-toggle arrow-none waves-effect waves-light"  href="/letter/home">
                		 
                		<span class = " position-relative">
                		 <img alt="" src="/assets/images/letter.png" width="30"  class= " position-relative"> 
                		 <span id = "tobbarLetterCnt"class="chkletterinit position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                            
                           <span class="visually-hidden">unread messages</span>
                       </span> 
                       </span>
              </a>
            </li>
            <li class="dropdown block">
                <a class="nav-link dropdown-toggle arrow-none waves-effect waves-light" data-toggle="" href="#">
                    <button class="btn btn-primary mt-2 mt-md-0" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasRight" aria-controls="offcanvasRight">
                    ğŸWidget           
                    </button>
                </a>
            </li>
    
            <li class="dropdown d-none d-lg-inline-block topbar-dropdown">
                <a class="nav-link dropdown-toggle arrow-none waves-effect waves-light" data-bs-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
                    <img src="${pageContext.request.contextPath }/resources/dist/assets/images/flags/us.jpg" alt="user-image" height="16">
                </a>
                <div class="dropdown-menu dropdown-menu-end">
    
                    <!-- item-->
                    <a href="javascript:void(0);" class="dropdown-item">
                        <img src="${pageContext.request.contextPath }/resources/dist/assets/images/flags/germany.jpg" alt="user-image" class="me-1" height="12"> <span class="align-middle">German</span>
                    </a>
    
    
                </div>
            </li>
            
            <li class="dropdown notification-list topbar-dropdown" id="notification1">
                <a class="nav-link dropdown-toggle waves-effect waves-light" data-bs-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
                    <i class="fe-bell noti-icon"></i>
                    <span class="badge bg-danger rounded-circle noti-icon-badge" id="alarmCnt_O">0</span>
                </a>
                <div class="dropdown-menu dropdown-menu-end dropdown-lg">
    
                    <!-- item-->
                    <div class="dropdown-item noti-title">
                        <h5 class="m-0">
                            <span class="float-end">
                                <a href="javascript:void(0)" class="text-dark" onclick="clearAllAlarm()">
                                    <small>Clear All</small>
                                </a>
                            </span>Notification
                        </h5>
                    </div>
    
                    <div class="noti-scroll" data-simplebar >
    					
    					<div id="alarm22">
                        <!-- item-->
                       
                        </div>
                        
                    </div>
    
                    <!-- All-->
                    <a href="javascript:void(0);" class="dropdown-item text-center text-primary notify-item notify-all">
                        View all
                        <i class="fe-arrow-right"></i>
                    </a>
    
                </div>
            </li>
    
            <li class="dropdown notification-list topbar-dropdown">
                <a class="nav-link dropdown-toggle nav-user me-0 waves-effect waves-light" data-bs-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false" id="myProfileImg">
<%--                     	<img src="${pageContext.request.contextPath }/resources/dist/assets/images/users/blank_progile.png" alt="user-image" class="rounded-circle"> --%>
<!--                     <span class="pro-user-name ms-1"> -->
<!--                       <i class="mdi mdi-chevron-down"></i>  -->
<!--                     </span> -->
                </a>
                <div class="dropdown-menu dropdown-menu-end profile-dropdown ">
                    <!-- item-->
    
                    <!-- item-->
                    <a href="/mypage/home" class="dropdown-item notify-item">
                        <i class="fe-user"></i>
                        <span>My Page</span>
                    </a>
    
                    <!-- item-->
                    <a href="javascript:void(0);" class="dropdown-item notify-item">
                        <i class="fe-lock"></i>
                        <span>Lock Screen</span>
                    </a>
    
                    <div class="dropdown-divider"></div>
    
                    <!-- item-->
                    <a href="#" class="dropdown-item notify-item" onclick="logout_H();">
                        <i class="fe-log-out"></i>
                        <span>Logout</span>
                    </a>
    
                </div>
            </li>
    
            <li class="dropdown notification-list">
                <a href="javascript:void(0);" class="nav-link right-bar-toggle waves-effect waves-light">
                    <i class="fe-settings noti-icon"></i>
                </a>
            </li>
    
        </ul>
    
        <!-- LOGO -->
        <div class="logo-box">
            <a href="/myhome/home" class="logo logo-dark text-center">
                <span class="logo-sm">
                    <img src="${pageContext.request.contextPath }/resources/dist/assets/images/logo-sm.png" alt="" height="22">
                    <!-- <span class="logo-lg-text-light">Codefox</span> -->
                </span>
                <span class="logo-lg">
                    <img src="${pageContext.request.contextPath }/resources/dist/assets/images/logo-dark.png" alt="" height="20">
                    <!-- <span class="logo-lg-text-light">U</span> -->
                </span>
            </a>
    
            <a href="/myhome/home" class="logo logo-light text-center">
                <span class="logo-sm">
                    <img src="${pageContext.request.contextPath }/resources/dist/assets/images/logo-sm.png" alt="" height="22">
                </span>
                <span class="logo-lg">
                    <img src="${pageContext.request.contextPath }/resources/dist/assets/images/logo-light.png" alt="" height="20">
                </span>
            </a>
        </div>

		<ul
			class="list-unstyled topnav-menu topnav-menu-left m-0">
			<li>
				<button class="button-menu-mobile waves-effect waves-light">
					<i class="fe-menu"></i>
				</button>
			</li>

			<li>
				<!-- Mobile menu toggle (Horizontal Layout)--> <a
				class="navbar-toggle nav-link" data-bs-toggle="collapse"
				data-bs-target="#topnav-menu-content">
					<div class="lines">
						<span></span> <span></span> <span></span>
					</div>
			</a> <!-- End mobile menu toggle-->
			</li>

			<li class="dropdown d-none d-xl-block">
			<a class="nav-link dropdown-toggle waves-effect waves-light"
				data-bs-toggle="dropdown" href="#" role="button"
				aria-haspopup="false" aria-expanded="false" style="color: white"> ê³ ê°ì„¼í„° <i
					class="mdi mdi-chevron-down"></i>
			</a>
				<div class="dropdown-menu">
					
					<!-- item-->
					<a href="javascript:void(0);" class="dropdown-item"><i
						class="mdi mdi-volume-high"></i> <span>&nbsp;ê³µì§€ì‚¬í•­</span>

					<!-- item-->
					<a href="/faq/faqMain" class="dropdown-item"> <i
						class="mdi mdi-help-circle"></i> <span>&nbsp;FAQ</span>
				
					<!-- item-->
					<a href="/oneoone/question" class="dropdown-item"> <i
						class="mdi mdi-headset"></i> <span>&nbsp;1:1ë¬¸ì˜</span>
					</a>

				</div></li>

			<li class="dropdown dropdown-mega d-none d-xl-block"><a
				class="nav-link dropdown-toggle waves-effect waves-light"
				data-bs-toggle="dropdown" href="#" role="button"
				aria-haspopup="false" aria-expanded="false"> Mega Menu <i
					class="mdi mdi-chevron-down"></i>
			</a>
				<div class="dropdown-menu dropdown-megamenu">
					<div class="row">
						<div class="col-sm-8">

							<div class="row">
								<div class="col-md-4">
									<h5 class="text-dark mt-0">UI Components</h5>
									<ul class="list-unstyled megamenu-list">
										<li><a href="javascript:void(0);">Widgets</a></li>
										<li><a href="javascript:void(0);">Nestable List</a></li>
										<li><a href="javascript:void(0);">Range Sliders</a></li>
										<li><a href="javascript:void(0);">Masonry Items</a></li>
										<li><a href="javascript:void(0);">Sweet Alerts</a></li>
										<li><a href="javascript:void(0);">Treeview Page</a></li>
										<li><a href="javascript:void(0);">Tour Page</a></li>
									</ul>
								</div>

								<div class="col-md-4">
									<h5 class="text-dark mt-0">Applications</h5>
									<ul class="list-unstyled megamenu-list">
										<li><a href="javascript:void(0);">eCommerce Pages</a></li>
										<li><a href="javascript:void(0);">CRM Pages</a></li>
										<li><a href="javascript:void(0);">Email</a></li>
										<li><a href="javascript:void(0);">Calendar</a></li>
										<li><a href="javascript:void(0);">Team Contacts</a></li>
										<li><a href="javascript:void(0);">Task Board</a></li>
										<li><a href="javascript:void(0);">Email Templates</a></li>
									</ul>
								</div>

								<div class="col-md-4">
									<h5 class="text-dark mt-0">Extra Pages</h5>
									<ul class="list-unstyled megamenu-list">
										<li><a href="javascript:void(0);">Left Sidebar with
												User</a></li>
										<li><a href="javascript:void(0);">Menu Collapsed</a></li>
										<li><a href="javascript:void(0);">Small Left Sidebar</a>
										</li>
										<li><a href="javascript:void(0);">New Header Style</a></li>
										<li><a href="javascript:void(0);">Search Result</a></li>
										<li><a href="javascript:void(0);">Gallery Pages</a></li>
										<li><a href="javascript:void(0);">Maintenance &
												Coming Soon</a></li>
									</ul>
								</div>
							</div>
						</div>
						<div class="col-sm-4">
							<div class="text-center mt-3">
								<h3 class="text-dark">Special Discount Sale!</h3>
								<h4>Save up to 70% off.</h4>
								<button class="btn btn-primary rounded-pill mt-3">Download
									Now</button>
							</div>
						</div>
					</div>

				</div></li>
		</ul>
		<div class="clearfix"></div>
    </div>

</div>
<!-- end Topbar -->


<!-- ìœ„ì ¯ë¶€ë¶„ -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight" aria-labelledby="offcanvasRightLabel">
    <div class="offcanvas-header">
        <h4 id="offcanvasRightLabel">My Widget</h4>
          <h4 class="header-title">ë‚˜ë§Œì˜ ìœ„ì ¯ì„ êµ¬ì„±í•˜ì„¸ìš”!</h4>
        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div> <!-- end offcanvas-header-->

    <div class="offcanvas-body">
        <div id="widget-time"></div>
        <div class="card-body" style="display: flex;">
            <div class="" style="display: flex; height: 40px;">
	            <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#bs-example-modal-lg">ì¶”ê°€</button>
	        </div>
		    <div 
		      class="container-widget-delete" 
		      id="dustbin" 
		      style="width: 60%; height: 100px; background-color: #ECF2F5; text-align: center; margin-left: 60px;">
		      <h3 class="">íœ´ì§€í†µ</h3>
		    </div>
		</div>
        <div class="card" id="icon-widget"> <!--  style="display: flex; flex-direction: row;" -->
            <div class="card-body">
                
            </div>
           <div id="widget-myList" class="container-widget"></div>
           
        </div>
       
    </div> <!-- end offcanvas-body-->
</div> <!-- end offcanvas-->

<!-- ìœ„ì ¯ ì¶”ê°€ ëª¨ë‹¬ -->
<!--  Modal content for the Large example -->
<div class="modal fade" id="bs-example-modal-lg" tabindex="-1" role="dialog"
    aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="myLargeModalLabel">Widget List</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal"
                    aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="widget-list"><!-- ìœ„ì ¯ ë¦¬ìŠ¤íŠ¸ë“¤ ì¶œë ¥í•´ì£¼ê¸° --></div>
                <div>
	                <button type="button" id="addWidget" class="btn btn-success waves-effect waves-light" data-bs-dismiss="modal" aria-label="Close">Add Widget</button>
	                <button type="button" id="" class="btn btn-danger waves-effect waves-light" data-bs-dismiss="modal" aria-label="Close">Close</button>
                </div>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<script>
var memberId = localStorage.getItem('id');
var memberToken = localStorage.getItem('token');
var alarmCount = document.getElementById("alarmCnt_O"); // ì•ŒëŒ ê°¯ìˆ˜ í‘œì‹œë“±
var webSocketAlarm;
let myAlarmId;
//ë¡œê·¸ì¸ì‹œ memberVO ê°ì²´ê°€ localì— ì €ì¥ë©ë‹ˆë‹¤. topbarì—ì„œ í™œìš©í•˜ì„¸ìš”
//ìœ„ì ¯ ì„ íƒë¦¬ìŠ¤íŠ¸ ëª¨ë‹¬ì— ë¿Œë¦¬ê¸°

//ì‹œì‘í•˜ìë§ˆì ì‹¤í–‰í•  ê²ƒë“¤  ì†Œìº£ìœ¼ë¡œ ì‹¤ì‹œê°„ì•ŒëŒìœ¼ë¡œ ì—…ê·¸ë ˆì´ë“œí• ì˜ˆì •
$(function(){
	 //ì§€í˜•ì´  ì›¹ì†Œì¼“ ìƒì„± 
    webSocketAlarm = new WebSocket("ws://192.168.144.3/ws-alarm");
	myAlarmId = localStorage.getItem("id");
	webSocketAlarm.onopen = () => {			
		console.log(webSocketAlarm.readyState); // 1ì´ë©´ ì—°ê²°ëœê±°ì„ 
		refreshMyAlarm(myAlarmId); // í˜ì´ì§€ ì´ë™í• ë•Œ ë§ˆë‹¤  ì†Œì¼“ì— ë‹¤ì‹œ ì ‘ì†í•˜ë¯€ë¡œ ë‹¤ë¥¸ WEBSESSIONê°’ì´ë¯€ë¡œ 
								   // ë’·ë‹¨ì— ë‹´ì•„ë‘” MAP<String, webSession> ì— í‚¤ê°’ì€ ì¤‘ë³µì•ˆë˜ë¯€ë¡œ ê°’ ê°ˆì•„ë¼ì›€
		webSocketAlarm.onmessage = aMessage;
	}	 

	checkletterCnt();
	//í˜„ì¬ ì•ˆì½ì€ ì•ŒëŒë“¤ ê°€ì ¸ì˜¤ëŠ” method ojh ì•ˆì— ê°¯ìˆ˜ë„ ìˆìŒ
	checkAlarm();
	
})

function clearAllAlarm(){
	console.log("clearAllAlarm ì ‘ì†");
	//ì—¬ê¸°ì„œ ë‚´ì´ë¦„ìœ¼ë¡œ ëœê±° ë‹¤ ì½ìŒ ì²˜ë¦¬í•œë‹¤ 
	var xhr = new XMLHttpRequest();
	let data =  {'memberId' : myAlarmId };
	xhr.open("post", '/alarm/deleteAllAlarm', true);
	xhr.onreadystatechange = function() {
		if(xhr.readyState == 4 && xhr.status == 200){	
			document.querySelector("#alarm22").innerHTML ="";
			alarmCount.innerText = 0; 
		}
	};
	xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
	xhr.send(JSON.stringify(data));
}

// ojh
function checkAlarm(){
	console.log("checkAlarmì— ë“¤ì–´ì™”ì–´ìš©~");
	//ì—¬ê¸°ì„œ í•´ë‹¹ ì‚¬ëŒì˜ ì•ˆì½ì€ ì•ŒëŒë“¤ ê°€ì ¸ì˜¨ë‹¤
	
	console.log("checkAlarmì•ˆì˜ memberId ",myAlarmId );
	var xhr = new XMLHttpRequest();
	let data =  {'memberId' : myAlarmId };
	xhr.open("post", '/alarm/getUnreadAlarm', true);
	let text = "";
	xhr.onreadystatechange = function() {
		if(xhr.readyState == 4 && xhr.status == 200){	
			//console.log(JSON.parse(xhr.responseText));
			makeAlarm(JSON.parse(xhr.responseText)); //ì•ŒëŒ êµ¬ë³„í•´ì¤˜ì„œ ëª¨ì–‘ ë§Œë“œëŠ” ê³³ 
		}
	};
	xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
	xhr.send(JSON.stringify(data));
}

//ì²˜ìŒ ì ‘ì†í–ˆì„ ë•Œë‚˜ ì‹¤ì‹œê°„ìœ¼ë¡œ ë°›ê³ ìˆì§€ ì•Šì„ë•Œ ì•ˆì½ì€ ì•ŒëŒë“¤ ëª¨ì•„ë†“ì€ê³³  ojh
function makeAlarm(json){
	var str = "";
	//console.log(json);
	console.log("ê¸¸ì´ :",json.length); // ì´ê±¸ë¡œ ì•ŒëŒ ê°¯ìˆ˜ ë§Œë“¤ìˆ˜ ìˆë‹¤ .
	
	var cnt = json.length;
	for(i in json) {
	    console.log( i, "ë²ˆì§¸ ë°ì´í„° ",json[i]);
	       
	    //ì±„íŒ…ë°© ì´ˆëŒ€ ì¸ê²½ìš° == 1 
	    if(json[i].alrTNo == "1"){	
	    	str += `<a href="/chat/chatMain?roomId=\${json[i].alarmData}" class="dropdown-item notify-item">
        		<div class="notify-icon bg-warning">
       			<i class="mdi mdi-account-plus"></i>
       				 </div>
       			  <p class="notify-details"> \${json[i].alarmSender}ë‹˜ì´ \${json[i].alarmContent}<small class="text-muted">1 min ago</small></p>
        		</a>`;  
	    }
	    //ë‚´ê¸€ì— ëŒ“ê¸€ ë‹¬ë ¸ì„ ë•Œ   devin ë¬¸ì˜ë‚´ì—­    
	    if(json[i].alrTNo == "2"){	
	    	str += `<a href="/devin/devinList?devinId=\${json[i].alarmData}" class="dropdown-item notify-item ">
        		<div class="notify-icon bg-primary">
       			<i class="mdi mdi-attachment"></i>
       				 </div>
       			  <p class="notify-details">\${json[i].alarmSender}ë‹˜ì´ \${json[i].alarmContent}<small class="text-muted">1 min ago</small></p>
        		</a>`;
	    }
	    //ì¢‹ì•„ìš” ë‹¬ë ¸ì„ ë•Œ
	    if(json[i].alrTNo == "3"){	
	    }
	    //í”„ë¡œì íŠ¸ ê´€ë ¨ ì•Œë¦¼  
	    if(json[i].alrTNo == "4"){		    	
	    }
	    //í”„ë¡œì íŠ¸ ì´ˆëŒ€   í”„ë¡œì íŠ¸ ë„˜ë²„ ë§Œ ìˆìŒë¨ proNO 
	    if(json[i].alrTNo == "5"){	
	    	
	    }
	    //ìª½ì§€      
	    if(json[i].alrTNo == "6"){	
	    	str += `<a href="/letter/home" class="dropdown-item notify-item ">
        		<div class="notify-icon bg-danger">
       			<i class="mdi mdi-email-outline"></i>
       				 </div>
       			  <p class="notify-details"> \${json[i].alarmSender}ìœ¼ë¡œë¶€í„° \${json[i].alarmContent}<small class="text-muted">1 min ago</small></p>
        		</a>`;     
	    }  // alrTNo == 6
	} //end of loop
	
	alarmCount.textContent=cnt; // ì•ŒëŒ ê°¯ìˆ˜ ì„¤ì • 
	$('#alarm22').prepend(str); 
}

// í•´ë‹¹ ìœ ì €ì—ê²Œ ì‹¤ì‹œê°„ìœ¼ë¡œ ì˜¤ëŠ” ë©”ì„¸ì§€ ì „ì²´ ì²˜ë¦¬í•˜ëŠ” ë¶€ë¶„ ojh
 function aMessage(){
	let Adata = JSON.parse(event.data);
	let str = "";
	console.log("ë°›ì•„ì˜¨ ë°ì´í„° : ", Adata);

	console.log(Adata.alarmType);
	
	if(Adata.alarmType == '1'){
		var roomId = Adata.roomNM;
		// a ë§í¬ì— í•¨ìˆ˜ë§Œë“œëŠ”ë°  ---  chatMain.jspë¥¼ ì´ë™ì‹œí‚¤ê³  --- ê°€ì ¸ì˜¨ roomId --- openROOm()
		str += `<a href="/chat/chatMain?roomId=\${roomId}" class="dropdown-item notify-item ">
        		<div class="notify-icon bg-warning">
       			<i class="mdi mdi-account-plus"></i>
       				 </div>
       			  <p class="notify-details"> \${Adata.sender}ë‹˜ì´ \${Adata.alarmContent}<small class="text-muted">1 min ago</small></p>
        		</a>`;     
		$('#alarm22').prepend(str); // í•´ë‹¹ ì•Œë¦¼ì°½ì— ë”í•´ì¤€ë‹¤ 
		alarmCount.textContent = parseInt(alarmCount.textContent) + 1; // í˜„ì¬ ê°¯ìˆ˜ intë¡œ ë°”ê¾¼í›„ 1ë”í•¨
		
	} // end of alertType == 1
	
	if(Adata.alarmType == '2'){
		var commentId = Adata.commentRoom;
		// a ë§í¬ì— í•¨ìˆ˜ë§Œë“œëŠ”ë°  ---  chatMain.jspë¥¼ ì´ë™ì‹œí‚¤ê³  --- ê°€ì ¸ì˜¨ roomId --- openROOm()
		str += `<a href="/devin/devinList?devinId=\${commentId}" class="dropdown-item notify-item ">
        		<div class="notify-icon bg-primary">
       			<i class="mdi mdi-attachment"></i>
       				 </div>
       			  <p class="notify-details"> \${Adata.sender}ë‹˜ì´ \${Adata.alarmContent}<small class="text-muted">1 min ago</small></p>
        		</a>`;
        		
		$('#alarm22').prepend(str); // í•´ë‹¹ ì•Œë¦¼ì°½ì— ë”í•´ì¤€ë‹¤ 
		alarmCount.textContent = parseInt(alarmCount.textContent) + 1; // í˜„ì¬ ê°¯ìˆ˜ intë¡œ ë°”ê¾¼í›„ 1ë”í•¨
		
	} // end of alertType == 1
	
	if(Adata.alarmType == '6'){	
		// a ë§í¬ì— í•¨ìˆ˜ë§Œë“œëŠ”ë°  ---  chatMain.jspë¥¼ ì´ë™ì‹œí‚¤ê³  --- ê°€ì ¸ì˜¨ roomId --- openROOm()
		str += `<a href="/letter/home" class="dropdown-item notify-item ">
        		<div class="notify-icon bg-warning">
       			<i class="mdi mdi-account-plus"></i>
       				 </div>
       			  <p class="notify-details"> \${Adata.sender}ìœ¼ë¡œë¶€í„° \${Adata.alarmContent}<small class="text-muted">1 min ago</small></p>
        		</a>`;     
		$('#alarm22').prepend(str); // í•´ë‹¹ ì•Œë¦¼ì°½ì— ë”í•´ì¤€ë‹¤ 
		alarmCount.textContent = parseInt(alarmCount.textContent) + 1; // í˜„ì¬ ê°¯ìˆ˜ intë¡œ ë°”ê¾¼í›„ 1ë”í•¨
		document.querySelector("#tobbarLetterCnt").textContent = parseInt(document.querySelector("#tobbarLetterCnt").textContent) + 1;
	} // end of alertType == 6
	
	
	
} 

// ì´í•¨ìˆ˜ëŠ” í•´ë‹¹ ìœ„ì¹˜ì—ì„œ  ojh
function  updateAlarm(myAlarmId, alarmType, receiverId, inData){   
	let alarmContent; 
	// myAlarmId : ë‚´ id 
	// alarmContent : ë¬´ìŠ¨ê¸€ì„ ì¨ì„œ ë³´ë‚¼ê»€ì§€ 	
	if(alarmType == "inviteChat") alarmContent = 'ìƒˆë¡œìš´ ì±„íŒ…ë°©ì— ì´ˆëŒ€ ë˜ì—ˆìŠµë‹ˆë‹¤.'; //ì±„íŒ…ë°© ë²ˆí˜¸ í•„ìš”
	if(alarmType == "inviteProject") alarmContent ='ìƒˆë¡œìš´ í”„ë¡œì­íŠ¸ì— ì´ˆëŒ€ ë˜ì—ˆìŠµë‹ˆë‹¤.'; //í”„ë¡œì íŠ¸ ë²ˆí˜¸
	if(alarmType == "comment") alarmContent = 'ì‘ì„±í•œ ê¸€ì— ëŒ“ê¸€ì„ ë‹¬ì•˜ìŠµë‹ˆë‹¤.'; //ëŒ“ê¸€ë²ˆí˜¸ 
	if(alarmType == "ProjectAssignment") alarmContent = 'í”„ë¡œì íŠ¸ì—ì„œ ì‘ì—…ì„ í• ë‹¹ë°›ì•˜ìŠµë‹ˆë‹¤.'; //ì‘ì—…ë²ˆí˜¸
	if(alarmType == "like") alarmContent = "ë‚´ ëŒ“ê¸€ì— ì¢‹ì•„ìš”ë¥¼ ëˆŒëŸ¬ì¤¬ìŠµë‹ˆë‹¤"; //ëŒ“ê¸€ë²ˆí˜¸
	if(alarmType == "sendLetter") alarmContent = "ìƒˆë¡œìš´ ìª½ì§€ê°€ ì™”ìŠµë‹ˆë‹¤." // ë‚˜í›”ì´í˜• ìª½ì§€ 
	
	var AlarmData = {
			'myAlarmId' : myAlarmId,
			'alarmContent' : alarmContent,
			'alarmType' : alarmType,
			'receiver' : receiverId,
			'inData' : inData
			}
	webSocketAlarm.send(JSON.stringify(AlarmData));
}

//ojh ì•ŒëŒ ê³„ì†ì ìœ¼ë¡œ refresh í•˜ëŠ” í•¨ìˆ˜ 
function refreshMyAlarm(myAlarmId){
	
	let data = 'refresh';
	
	var refreshData = {
			'myAlarmId' : myAlarmId,
			'alarmContent' : "refresh",
			'alarmType' : "refresh",
			'receiver' : "none",
			'inData' : data
			}
	
	console.log(refreshData);
	webSocketAlarm.send(JSON.stringify(refreshData));
}

getMemberDetail_B();

function getMemberDetail_B(){
	   var memberId ={
	         memberId : localStorage.getItem('id')
	   }
	   $.ajax({
	      url : "/member/selectMember",
	      type : "post",
	      data : JSON.stringify(memberId),
	      contentType : 'application/json; charset=utf-8',
	      dataType : 'json',
	      success : function(res) {
	         console.log(res)
	     	let Str = ""
				if(res.memberPic == 0){
					Str += `<img src="${pageContext.request.contextPath }/resources/dist/assets/images/users/blank_progile.png" alt="user-image" class="rounded-circle">`;
				}else{
					Str += `<img src="\${res.memberPic}" alt="user-image" class="rounded-circle">`;
				}
				Str += `<span class="pro-user-name ms-1">
			          \${res.memberName}<i class="mdi mdi-chevron-down"></i> 
			              </span>`;
			              
				myProfileImg.innerHTML = Str;
	      },
	   });//ajax
}


/* ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ë¹„ì–´ìˆìœ¼ë©´ ì¼ë‹¨ ì´ˆê¸°í™” */
window.addEventListener("DOMContentLoaded", (event) => {
	memberId = localStorage.getItem('id');
	memberToken = localStorage.getItem('token');
	memberPic = localStorage.getItem('pic');
	console.log(memberPic)
	
	if (memberId == null || memberId== '') {
		localStorage.removeItem('id');
	}else if (memberToken == null || memberToken == ''){
		localStorage.removeItem('token');
	}else if (memberPic == null || memberPic == ''){
		localStorage.removeItem('pic');
	}
    console.log("DOMContentLoaded");
});

	/* ë¡œê·¸ì•„ì›ƒê³¼ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì‚­ì œ */
function logout_H(){
	var memberVO ={
	         memberId : localStorage.getItem('id')
	   }
	kakaoLogout();
	localStorage.removeItem('id');
	localStorage.removeItem('token');
	location.href= "/login"
		$.ajax({
			url : "/logout",
			type : "post",
			data : JSON.stringify(memberVO),
			contentType : 'application/json; charset=utf-8',
			dataType : 'json',
			success : function(res) {
				console.log("ë¡œê·¸ì•„ì›ƒ : "+ res)
				
			},

		});//ajax
}
//ì¹´ì¹´ì˜¤ë¡œê·¸ì•„ì›ƒ
Kakao.init('cbfd91d2833351668be647432e1a4c13'); //ë°œê¸‰ë°›ì€ í‚¤ ì¤‘ javascriptí‚¤ë¥¼ ì‚¬ìš©í•´ì¤€ë‹¤.
function kakaoLogout() {
    if (Kakao.Auth.getAccessToken()) {
      Kakao.API.request({
        url: '/v1/user/unlink',
        success: function (response) {
        	console.log(response)
        },
        fail: function (error) {
          console.log(error)
        },
      })
      Kakao.Auth.setAccessToken(undefined)
    }
  }  
	
////////////////// ìœ„ì ¯ ê´€ë ¨ - ê¹€ì§„í˜¸

//ë Œë”ë§ í•¨ìˆ˜
renderWidgetList_K(); //ì„±ê³µ
renderWidgetBar_K(); //ì„±ê³µ

var btnAddWidget_K = document.querySelector("#addWidget");
var btnResetWidget_K = document.querySelector("#resetWidget");

/* ë‚ ì”¨ API ì‹œì‘ */
var API_KEY_WEATHER = "26329357974be09d714c1296fe958784";
function onGeoOk(position) {
    const lat = position.coords.latitude; //userì˜ ìœ„ë„
    const lon = position.coords.longitude; //userì˜ ê²½ë„
    const url = "https://api.openweathermap.org/data/2.5/weather?lat=" + lat + "&lon="
                 + lon + "&appid=" + API_KEY_WEATHER + "&units=metric";
            
    fetch(url)
        .then(response => response.json())
        .then(data => {
            //console.log(data.name, data.weather[0].main);
            const weather = document.querySelector("#widget-weather span:first-child");
            const city = document.querySelector("#widget-weather span:last-child");
            weather.innerHTML = "<h2>ë‚ ì”¨ ğŸŒ  " + data.weather[0].main + " / ğŸŒ¡" +data.main.temp + "Â°C</h2>";
            city.innerHTML = "<h2>ì ‘ì† ì§€ì—­ ğŸŒ" + data.name + "</h2>";
        });
}

function onGeoError() {
    alert("Can't find you. No weater for you.");
}
/* ë‚ ì”¨ ë */

/* ì‹œê³„ API ì‹œì‘ */
function getClock() {
    const date = new Date();
    const hours = String( date.getHours() ).padStart(2, "0");
    const minutes = String( date.getMinutes() ).padStart(2, "0");
    const seconds = String( date.getSeconds() ).padStart(2, "0");
    const clock = document.querySelector("#widget-time");
    clock.innerHTML = `<h4>í˜„ì¬ ì‹œê°„ : \${hours } : \${minutes} : \${seconds}</h4>`;
}

getClock();
setInterval(getClock, 1000);
/* ì‹œê³„ ë */

      
//ì°¨íŠ¸ API
//ì°¨íŠ¸ ì˜µì…˜
//7ì¼ì´ë‚´ ë§ˆê° ì°¨íŠ¸ ë°ì´í„° : (ë”± 3ê°œë§Œ ë½‘ìœ¼ë©´ ë¨)
//dataì— x, y, goals ì§€ì •í•˜ê¸°

//ì°¨íŠ¸-ë‚˜ì˜ ì‘ì—… ì‹œì‘

//ì˜¤í”„ìº”ë²„ìŠ¤
function offCanvasListener(offCanvasId) {
  let myOffCanvas = document.getElementById(offCanvasId);

  const hideCanvas = () => {
    let openedCanvas = bootstrap.Offcanvas.getInstance(myOffCanvas);
    openedCanvas.hide();
    event.target.removeEventListener('mouseleave', hideCanvas);
  }
  const listenToMouseLeave = (event) => {
    event.target.addEventListener('mouseleave', hideCanvas);
  }
  
  myOffCanvas.addEventListener('shown.bs.offcanvas', listenToMouseLeave);
}

//offCanvasListener('offcanvasRight');

//ìœ„ì ¯ ì¶”ê°€ ë²„íŠ¼
btnAddWidget_K.addEventListener("click", () => {
    const selectedWidget = document.querySelectorAll(".widget");
    console.log("ìœ„ì ¯ì„ íƒ", selectedWidget);
    
    const addWidgetList = [];
    
    for (item of selectedWidget) {
        console.log("ì²´í¬ì—¬ë¶€", item.checked);
        //console.dir(item.classList[2].split("-")[1]); ì´ê²Œ widgetNo.
        if (item.checked) {
            //console.log("ì¶”ê°€í•œ ìœ„ì ¯ í´ë˜ìŠ¤ : ", item.classList[2]);
            let widgetNo = item.classList[2].split("-")[1];
            
            let widgetVO = {
                widgetNo
            };
            
            addWidgetList.push(widgetVO);
        }
        
    }
    //console.log("addWidgetList", addWidgetList);
    //ì„ íƒí•œ ê°ì²´ê°€ ë‹´ê¸´ ë°°ì—´ ë„˜ê²¨ì£¼ê¸°
    saveWidget_K(addWidgetList);
    renderWidgetList_K();
    document.querySelector("#bs-example-modal-lg").classList.remove("show");
    document.querySelector("#bs-example-modal-lg").style.display = "none";
});

//ì¶”ê°€ ê°€ëŠ¥í•œ ìœ„ì ¯ ë¦¬ìŠ¤íŠ¸ ë§Œë“¤ê¸° -> ì´ë¯¸ ì‚¬ìš©ì¤‘ì¸ê±° ì²˜ë¦¬í•´ì£¼ê¸°
function renderWidgetList_K() {
    const target = document.querySelector("#widget-list");
    
    axios
      .get("/widget/list")
      .then((res) => {
          console.log("ë„˜ì–´ì˜¤ëŠ” ë¦¬ìŠ¤íŠ¸ëª©ë¡ : ", res);
          const json = res.data;
          const renderWidgetList = [];
          const renderWidgetList2 = [];
          const renderWidgetList3 = [];
          
          let text = "";
         //íƒœê·¸ ê·¸ë¦¬ê¸° ì „ ë‚´ ëª©ë¡ ë¨¼ì € í™•ì¸í•˜ê¸°
         const widgetBarVO = {
           memberId,
         };
         
         axios
           .post("/widget/myWidgetList", widgetBarVO)
           .then((result) => {
        	     console.log("ë‚´ê°€ ì“°ëŠ” ìœ„ì ¯ë“¤ : ", result.data );
        	     console.log("ì „ì²´ìœ„ì ¯ ë¦¬ìŠ¤íŠ¸ : ", json);
        	     let myWidgetList = result.data;
        	     
        	     //ë‚˜ì˜ ë¦¬ìŠ¤íŠ¸ì™€ ê°™ìœ¼ë©´ ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€. (ë‚˜ì˜ ë¦¬ìŠ¤íŠ¸ì™€ ë™ì¼í•˜ê²Œ êµ¬ì„±ë˜ê²Ÿë„¤..)
        	     for (let i = 0; i < myWidgetList.length; i++) {
        	    	 //íŒŒì¸ë“œ, í•„í„°ëŠ” ì ì ˆí•˜ì§€ ì•ŠìŒ.
        	    	 //ì „ì²´ë¦¬ìŠ¤íŠ¸ ìˆœí™˜í•˜ë©´ì„œ ë‚´ ë¦¬ìŠ¤íŠ¸ì™€ ì¼ì¹˜í•˜ëŠ”ê±´ ì œì™¸í•˜ê¸°
        	    	 json.forEach((item, index) => {
        	    		if (item.widgetNo == myWidgetList[i].widgetNo) {
        	    			json.splice(index, 1);
        	    		} 
        	    	 });
        	     }
        	     console.log("json : ", json);
        	     
		         //ë‚´ê°€ ì´ë¯¸ ì“°ëŠ” ìœ„ì ¯ë“¤ì€ ì•„ì˜ˆ ì•ˆëœ¸		         
		         for (item of json) {
		        	 console.log("ê·¸ë¦´ ì•„ì´í…œ : ", item); //ì•ˆì°í˜”ë˜ ì´ìœ ëŠ” ë¹„ë™ê¸° ì•ˆì—ì„œ ì‹¤í–‰ì„ ì•ˆí•´ì„œ..
		              text += `<div class="form-check mb-2 form-check-primary">`;
		              text += `<input class="form-check-input widget widgetList-\${item.widgetNo}" type="checkbox" value="\${item.widgetName}" id="customckeck-\${item.widgetName}">`;
		              text += `<label class="form-check-label" for="customckeck-\${item.widgetName}">\${item.widgetName}</label>`;
		              text += `</div>`;
		          }
		         //ì‹œê°„ë ë•Œ ì‚¬ìš©ì¤‘ì¸ ë¦¬ìŠ¤íŠ¸ë„ ì¶œë ¥í•´ì£¼ë„ë¡? -> ì´ê±´ ë‚˜ì˜ ì¿¼ë¦¬ë¡œ xx ì¿¼ë¦¬ìˆ˜ì •
		         for (item of myWidgetList) {
		              text += `<div class="form-check mb-2">`;
		              text += `<input class="form-check-input widget widgetList-\${item.widgetNo}" type="checkbox" value="\${item.widgetName}" id="customckeck-\${item.widgetName}" disabled>`;
		              text += `<label class="form-check-label" for="customckeck-\${item.widgetName}">\${item.widgetName}</label>`;
		              text += `</div>`;
		         }
		         
		          target.innerHTML = text;
           });
         
      });
}

//íšŒì›ì˜ ìœ„ì ¯ ë¦¬ìŠ¤íŠ¸ ì €ì¥í•˜ê¸°
function saveWidget_K(addWidgetList) { //ì—¬ê¸°ì„œ ë„¤ê°œë§Œ ë“¤ì–´ê°€ë©´ ì•ˆë¨. -> save ë²„íŠ¼ ë§ê³  add ë²„íŠ¼ìœ¼ë¡œ ì¶”ê°€ì™€ ë™ì‹œì— ì €ì¥í•´ì•¼í• ë“¯.
	//ìš°ì„  í˜„ì¬ divë‚´ìš© íƒìƒ‰
	//const wList = document.querySelector("#widget-myList");
	//console.log("addWidgetList");
	//console.log(addWidgetList);//widgetNo ë‹´ê²¨ìˆìŒ.
	
	for (let i = 0; i < addWidgetList.length; i++) {
		//ìš°ì„ ì€ ì¦ê²¨ì°¾ê¸° ëª©ë¡ ì—†ì´ ë‹¨ì¼ ëª©ë¡ìœ¼ë¡œ ê°œë°œ ì‹œì‘
		//ìœ„ì ¯ë³„ë¡œ ê°ê° í•œë²ˆì”© inset ë“¤ì–´ê°€ì•¼í•¨. 
		let widgetNo = addWidgetList[i].widgetNo;
		let widgetBarVO = {
		  widgetNo,
		  memberId,
		  widgetBarTitle: "í…ŒìŠ¤íŠ¸ìœ„ì ¯ë°”"
		};
		
		axios
		  .post("/widget/insertWidgetBar", widgetBarVO)
		  .then((res) => {
			  //console.log(res);ìœ„ì ¯ë°”ì— ë“±ë¡ ì„±ê³µ
			  renderWidgetBar_K();
		  });
	}
}

//í•´ë‹¹ íšŒì›ì˜ ìœ„ì ¯ ë¦¬ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸°
function renderWidgetBar_K() {
	//console.log("ìœ„ì ¯ ë Œë”í•  ë©¤ë²„ ì•„ì´ë”” : ", memberId);
	const widgetBarVO = {
	  memberId,
	};
	
	axios
	  .post("/widget/myWidgetList", widgetBarVO)
	  .then((res) => {
		//console.log("ë‚´ ìœ„ì ¯ëª©ë¡ : ", res.data); //ì˜ ê°€ì ¸ì˜´. ì´ì œ ì´ê±¸ í† ëŒ€ë¡œ ê·¸ë ¤ì¤˜ì•¼í•¨.
		
		renderWidgetItem_K(res.data);
	  });
}

function renderWidgetItem_K(widgetList) { //+= ë°©ì‹ì´ ì•„ë‹ˆë¼ + ë°©ì‹ìœ¼ë¡œ..
	let text = "";
	const selectList = [];
	
	for (item of widgetList) {
		//ë©”ëª¨ì¥
		if (item.widgetNo == 1) {
			selectList.push("memo");
            text += `<div id="widget-memo" style="height: 220px; width: 100%;" class="widgetNo-1 widgetBarNo-\${item.widgetBarNo}">`;
            text += `</div>`;
        }  
        //ë‚ ì”¨
        if (item.widgetNo == 2) {
        	selectList.push("weather");
            text += `<div id="widget-weather" class="widgetNo-2 widgetBarNo-\${item.widgetBarNo}">`;
            text += ` <span style="color: black;"></span>`;
            text += ` <span style="color: black;"></span>`;
            text += `</div>`;
        }
        
        //ì°¨íŠ¸ - 7ì¼ ì´ë‚´ ë§ˆê°
        if (item.widgetNo == 4) {
        	selectList.push("chart-project");
            text += `<div id="widget-chart-project" class="widgetNo-4 widgetBarNo-\${item.widgetBarNo}"></div>`;
        }
        //ì°¨íŠ¸ - ë‚˜ì˜ ì¼ê°
        if (item.widgetNo == 5) {
        	selectList.push("calculator");
            text += `<div id="widget-calculator" class="widgetNo-5 widgetBarNo-\${item.widgetBarNo}"></div>`;
        }
	}
	
	document.querySelector("#widget-myList").innerHTML = text;
	
	if (selectList.includes("memo")) {
		var memoDiv = document.querySelector("#widget-memo");
		let memoText = ``;
		memoText += `<div style="background-color: #F2DF81; text-align: right;">`;
		memoText += `  <button class="btn btn-soft-warning waves-effect waves-light btn-memo" id="btnMemo" style="color: black;"`;
		memoText += ` onclick="memoListRender()">ëª©ë¡</button>`;
		memoText += `</div>`;
		memoText += `<div id="memo-table-div"><textarea id="memoTextArea"></textarea>`;
		memoText += `<div style="text-align: right;">`;
		memoText += `<button class="btn btn-soft-warning waves-effect waves-light btn-memo" `;
		memoText += ` style="color: black; background: #FBF9C6;" onclick="saveMemo()">ì €ì¥</button>`;
		memoText += `</div>`;
		memoText += `</div>`;
		memoDiv.innerHTML = memoText;
		/* 
        var gridDiv = document.querySelector('#widget-memo');
        new agGrid.Grid(gridDiv, gridOptions);
         */
    }
    
    if (selectList.includes("weather")) {
        //success í•¨ìˆ˜ì™€ error í•¨ìˆ˜ë¥¼ ì¸ìë¡œ ë°›ìŒ.
        navigator.geolocation.getCurrentPosition(onGeoOk, onGeoError);
    }
    
    if (selectList.includes("chart-project")) {
        //var chartProject = new ApexCharts(document.querySelector("#widget-chart-project"), optionsProjectChart_K);
        const memberVO = {
          memberId,	
        };
        
        axios
          .post("/member/my7Chart", memberVO)
          .then((res) => {
        	const mapList = res.data; //ì¸ë±ìŠ¤3ê¹Œì§€ë§Œ ì‚¬ìš©
        	const chartArray = [];
        	let i = 0;
        	
        	for (map of mapList) {
        		map.x = map.TOPWORK_TITLE;
        		map.y = [
        			new Date(map.TOPWORK_START).getTime(),
        			new Date(map.TOPWORK_END).getTime(),
        		];
        		
        		if (i == 0) {
         		  map.fillColor = "#e0490d";
        		}
        		if (i == 1) {
         		  map.fillColor = "#FFD10E";
        		}
        		if (i == 2) {
         		  map.fillColor = "#01FF54";
        		}
        		if (i == 3) {
        		  map.fillColor = "#12BAFF";
        		}
        		
        		chartArray.push(map);
        		
        		if (i == 3) {
        		  break;
        		}
        		
        		i++;
        	}
        	
        	console.log("ìˆ˜ì •ëœ ë§µë°ì´í„° : ", chartArray);
        	//ì°¨íŠ¸ì´ˆê¸°í™”
        	document.querySelector("#widget-chart-project").innerHTML = "";
	        var chartProject = new ApexCharts(document.querySelector("#widget-chart-project"), {
	        	//ë°ì´í„° ê·¸ë¦¬ê¸°
	            series: [
	                {
	                  data: chartArray,
	                }
	              ],
	                chart: {
	                height: 200,
	                width: 345,
	                type: 'rangeBar',
	              },
	              plotOptions: {
	                bar: {
	                  horizontal: true,
	                  distributed: true,
	                  dataLabels: {
	                    hideOverflowingLabels: false
	                  }
	                }
	              },
	              dataLabels: {
	                enabled: true,
	                formatter: function(val, opts) {
	                  var label = opts.w.globals.labels[opts.dataPointIndex]
	                  var a = moment(val[0])
	                  var b = moment(val[1])
	                  var diff = b.diff(a, 'days')
	                  return label + ': ' + diff + (diff > 1 ? ' days' : ' day')
	                },
	                style: {
	                  colors: ['#6F8092', '#6F8092']
	                }
	              },
	              xaxis: {
	                type: 'datetime'
	              },
	              yaxis: {
	                show: false
	              },
	              grid: {
	                row: {
	                  colors: ['#f3f4f5', '#fff'],
	                  opacity: 1
	                }
	              }
	        });
	        chartProject.render();
        	  
          })
    }
    
    if (selectList.includes("calculator")) {
        let calText = ``;
        calText += `<div id="calculator">`;
	    calText += `    <div id="input-wrap">`;
	    calText += `        <div id="tmp"></div>`;
	    calText += `        <div id="input"></div>`;
	    calText += `    </div>`;
	    calText += `    <div id="button-wrap">`;
	    calText += `        <button id="all-clear">AC</button>`;
	    calText += `        <button id="clear">C</button>`;
	    calText += `        <button id="sign">+/-</button>`;
	    calText += `        <button class="amt divide">/</button>`;
	    calText += ``;
	    calText += `        <button class="number">7</button>`;
	    calText += `        <button class="number">8</button>`;
	    calText += `        <button class="number">9</button>`;
	    calText += `        <button class="amt times">*</button>`;
	    calText += ``;
	    calText += `        <button class="number">4</button>`;
	    calText += `        <button class="number">5</button>`;
	    calText += `        <button class="number">6</button>`;
	    calText += `        <button class="amt minus">-</button>`;
	    calText += ``;
	    calText += `        <button class="number">1</button>`;
	    calText += `        <button class="number">2</button>`;
	    calText += `        <button class="number">3</button>`;
	    calText += `        <button class="amt plus">+</button>`;
	    calText += ``;
	    calText += `        <button class="number num-0">0</button>`;
	    calText += `        <button id="dot">.</button>`;
	    calText += `        <button id="result">=</button>`;
	    calText += `    </div>`;
	    calText += `</div>
	    
	    document.querySelector("#widget-calculator").innerHTML = calText;
	    
	    
    }
    
    //ìœ„ì ¯ ë‹¤ ê·¸ë¦¬ê³  ë“œë˜ê·¸ ì´ë²¤íŠ¸ ê±¸ê¸°
    const container = document.querySelector(".container-widget");
    const containerSideBar = document.querySelector(".container-widget2");
    const containerDustbin = document.querySelector(".container-widget-delete");
    
    new Sortable(container, {
        group: {
            name: "shared", //ì´ê²Œ ê°™ì€ Sortable ê°ì²´ë“¤ë¼ë¦¬ ì´ë™ ê°€ëŠ¥
          },
          swapThreshold: 1,
          animation: 150,
          ghostClass: "blue-background-class",
          //sort: false, ì´ê±° falseí•˜ë©´ ì›ë˜ ì˜ì—­ ë‚´ì—ì„œëŠ” ì•ˆì›€ì§ì„
          onChoose: function (event) {
            //í´ë¦­í•œ ì•„ì´í…œ
            //ì„ íƒí•œ ì˜ì—­ ì•ˆì— í…Œì´ë¸” ëª©ë¡
            //console.log("ì‹œì‘~~~"); //ê·¼ë° ë§ˆìš°ìŠ¤ê°€ ë– ë‚˜ì•¼ë§Œ ì´ê²Œ ì‹¤í–‰ë˜ì–´ì•¼ í•¨... ê·¼ë° ë“œë˜ê·¸ ì‹œì‘í•˜ë©´ ëª»ì¡ìŒ..?
            function delay() {
                let myOffCanvas = document.querySelector("#offcanvasRight"); 
                let openedCanvas = bootstrap.Offcanvas.getInstance(myOffCanvas);
                openedCanvas.hide();
            }
            
            //setTimeout(delay, 1000);
          },
          filter: ".filtered",
          onEnd: function (event) {
            //ë‚´ë ¤ë†“ì•˜ì„ë•Œ!
            ////////////////////////////////////////////////////////////////////////
            // ìœ„ì ¯ ì´ë™ì‹œ ìœ„ì¹˜ ì¡ì•„ì£¼ê¸°  
            ////////////////////////////////////////////////////////////////////////
            //console.log("ë‚´ë ¤ë†“ì€ ê³³", event.item);
            //console.log("ë‚´ë ¤ë†“ì€ ê³³ ë¶€ëª¨ : ", event.item.parentElement);
            const parentDiv = event.item.parentElement
            //console.log("ë¶€ëª¨ ë””ë¸Œì•„ì´ë”” : ", parentDiv.id);
            
            //ì‚­ì œì¼ë•ŒëŠ” ì˜ˆì™¸ ì²˜ë¦¬
            if (parentDiv.id == "dustbin") {
            	//console.log("ì´ í•¨ìˆ˜ëŠ” ë¹ ì ¸ë‚˜ê°‘ë‹ˆë‹¤.");
            	return;
            }
            
            const arr = parentDiv.children;
            //console.log(arr); //ìì‹ ìˆœì„œëŒ€ë¡œ ë½‘í˜.
            for (let i = 0; i < arr.length; i++) {
            	//console.log(`\${i}ë²ˆì§¸ ìì‹ : `,arr[i]);
            	let moveChild = arr[i].classList[1]; //widgetBarNo-1 ì´ëŸ°ì‹ìœ¼ë¡œ ë½‘í˜.
            	let widgetBarNo = moveChild.split("-")[1];
            	console.log("widgetBarNo : ", moveChild, " ìœ„ì¹˜ : ", i); //ìœ„ì¹˜ ê°’ì€ 0ë¶€í„° ì‹œì‘í•˜ëŠ”ê±¸ë¡œí•˜ì.
            	let widgetBarVO = {
            		widgetBarNo,
            		widgetWBLocation: i
            	};
            	//ë°˜ë³µë¬¸ ì•ˆì—ì„œ ë³´ë‚´ì•¼í•¨
            	console.log("ë³´ë‚¼ ê°ì²´ : ", widgetBarVO);
            	axios
            	  .post("/widget/moveWidget", widgetBarVO)
            	  .then((res) => {
            		  console.log(res);
            	  });
            }
            
          },
          onAdd: function (event) {
        	  //console.log("ë“œë? : ", event);
          },
          onMove: function(event) {
        	  //console.log("ë¬´ë¸Œ : ", event);
          }
    });
    new Sortable(containerSideBar, { //ë°”ê¹¥ ì‚¬ì´ë“œë°”ì˜ì—­
        group: {
            name: "shared", //ì´ê²Œ ê°™ì€ Sortable ê°ì²´ë“¤ë¼ë¦¬ ì´ë™ ê°€ëŠ¥
          },
          swapThreshold: 1,
          animation: 150,
          ghostClass: "blue-background-class",
          //sort: false, ì´ê±° falseí•˜ë©´ ì›ë˜ ì˜ì—­ ë‚´ì—ì„œëŠ” ì•ˆì›€ì§ì„
          onChoose: function (event) {
            //í´ë¦­í•œ ì•„ì´í…œ
            //ì„ íƒí•œ ì˜ì—­ ì•ˆì— í…Œì´ë¸” ëª©ë¡
            //console.log("ì‹œì‘~~~");
          },
          filter: ".filtered",
          onEnd: function (event) {
            //ë‚´ë ¤ë†“ì•˜ì„ë•Œ!
          },
    });
    new Sortable(containerDustbin, {
        group: {
            name: "shared", //ì´ê²Œ ê°™ì€ Sortable ê°ì²´ë“¤ë¼ë¦¬ ì´ë™ ê°€ëŠ¥
          },
          swapThreshold: 1,
          animation: 150,
          ghostClass: "blue-background-class",
          filter: ".filtered",
          //sort: false, ì´ê±° falseí•˜ë©´ ì›ë˜ ì˜ì—­ ë‚´ì—ì„œëŠ” ì•ˆì›€ì§ì„
          onChoose: function (event) {
            //í´ë¦­í•œ ì•„ì´í…œ
            //ì„ íƒí•œ ì˜ì—­ ì•ˆì— í…Œì´ë¸” ëª©ë¡
            //console.log("ì‹œì‘~~~");
          },
          onEnd: function (event) {
        	  console.log(event.item);
            //ë‚´ë ¤ë†“ì•˜ì„ë•Œ!
          },
          onAdd: function (event) {
        	  //ì•„ì´í…œì´ íœ´ì§€í†µì— ë“¤ì–´ê°”ì„ ë•Œ!
              //console.dir(event.item);
              //console.log(event.item);
        	  //console.log("ë‚´ì•„ì´ë”” : ", memberId, "widgetNo : ", event.item.classList[0].split("-")[1]);
        	  let widgetBarNo = event.item.classList[1].split("-")[1];
        	  let widgetNo = event.item.classList[0].split("-")[1];
        	  //console.log("widgetBarNo", widgetBarNo)
        	  const widgetBarVO = {
        		memberId,
        		widgetNo,
        		widgetBarNo
        	  };
        	  
        	  axios
        	    .post("/widget/deleteWidgetBar", widgetBarVO)
        	    .then((res) => {
        	    	//console.log(res); ì‚­ì œ ì˜ ë¨. 
        	    	//ì‚­ì œ ëìœ¼ë©´ íœ´ì§€í†µ ë¹„ìš°ê¸° + ë‹¤ì‹œ ê·¸ë ¤ì£¼ê¸°
        	    	document.querySelector("#dustbin").innerHTML = `<h3 class="">íœ´ì§€í†µ</h3>`;  	    	
        	    	renderWidgetBar_K();
        	    	renderWidgetList_K();
        	    });
        	  
          },
    });
    
};


//ë©”ëª¨ì¥ ë¦¬ìŠ¤íŠ¸ë³€í™˜
function memoListRender(mode, memoNo) {
	const btnMemo = document.querySelector("#btnMemo");
	const memoDiv = document.querySelector("#memo-table-div");
	
	
	if (mode == "detail") {
		const memoVO = {
		  memoNo,	
		};
		
		axios
		  .post("/member/selectMemo", memoVO)
		  .then((res) => {
			  const memo = res.data;
			  
			  btnMemo.innerText = "ëª©ë¡";
	          let memoText = ``;
	          memoText += `<textarea id="memoTextArea"></textarea>`;
	          memoText += `<div style="text-align: right;">`;
	          memoText += `<button class="btn btn-soft-warning waves-effect waves-light btn-memo" `;
	          memoText += ` style="color: black; background: #FBF9C6;" onclick="saveMemo('update', \${memo.memoNo})">ì €ì¥</button>`;
	          memoText += `</div>`;
	          
	          memoDiv.innerHTML = memoText;
	          
	          document.querySelector("#memoTextArea").value = memo.memoContent;
	          
	          return;
		  });
		
		
	}
	
	if (btnMemo.innerText == "ëª©ë¡") {
		btnMemo.innerText = "ë©”ëª¨";
	} else {
		btnMemo.innerText = "ëª©ë¡";
		let memoText = ``;
		memoText += `<textarea id="memoTextArea"></textarea>`;
        memoText += `<div style="text-align: right;">`;
        memoText += `<button class="btn btn-soft-warning waves-effect waves-light btn-memo" `;
        memoText += ` style="color: black; background: #FBF9C6;" onclick="saveMemo()">ì €ì¥</button>`;
        memoText += `</div>`;
        
		memoDiv.innerHTML = memoText;
		return;
	}
	
	let memoText = ``;
	memoText += `<table id="widget-memo-table">`;
	memoText += `<thead>`;
	memoText += `<tr>`;
	memoText += `<th>ë‚´ìš©</th>`;
	memoText += `<th>ë‚ ì§œ</th>`;
	memoText += `<th>ì‚­ì œ</th>`;
	memoText += `</tr>`;
	memoText += `</thead>`;
	memoText += `<tbody>`;
	memoText += `<tr>`;
	memoText += `<td></td>`;
	memoText += `<td></td>`;
	memoText += `<td></td>`;
	memoText += `</tr>`;
	memoText += `</tbody>`;
	memoText += `</table>`;
	
	memoDiv.innerHTML = memoText;
	
	const memberVO = {
	  memberId,	
	};
	
	axios
	  .post("/member/memoList", memberVO)
	  .then((res) => {
		  const memoList = res.data;
		  //console.log("ë©”ëª¨ : ", memoList);
		  for (memo of memoList) {
			  if (memo.memoContent.length > 14) {
				  memo.memoContent = memo.memoContent.substr(0, 13) + "...";
			  }
			  
			  memo.memoContent = `<a href="javascript: memoListRender('detail', \${memo.memoNo});">\${memo.memoContent}</a>`;
			  memo.deleted = `<span class="badge bg-danger" onclick="memoDelete(\${memo.memoNo})"><i class="mdi mdi-window-close"></i></span>`;
		  }
		  
		  const memoTable = $('#widget-memo-table').removeAttr("width").DataTable({
		         order: [[1, 'asc']],
		         ordering: true,
		         responsive:false,
		         //retrieve: true,
		         //scrollX: true,
		         //scrollCollapse:true,
		         searching: false,
		         lengthChange: false,
		         //paging: true,
		         destroy: true,
		         pageLength: 5,
		         //lengthMenu: [5, 7, 10],
		         columnDefs: [
		             {width: 150, targets: 0}, //targetì€ ì»¬ëŸ¼ìˆœì„œ. ì»¬ëŸ¼ë³„ ì‚¬ì´ì¦ˆ ì¡°ì ˆ
		             {width: 70, targets: 1},
		             {targets: 2, orderable: false}
		         ],
		         data: memoList,
		         columns: [
		             { data: "memoContent" },
		             { data: "memoDate" },
		             { data: "deleted" },
		         ],
		         language: {
		             emptyTable: "ë©”ëª¨ê°€ ì—†ìŠµë‹ˆë‹¤.",
		             lengthMenu: "_MENU_ ê°œì”© ë³´ê¸°",
		             info: "ì´ _TOTAL_ê±´",
		             infoEmpty: "ë°ì´í„° ì—†ìŒ",
		             infoFiltered: "( _MAX_ê±´ì˜ ë°ì´í„°ì—ì„œ í•„í„°ë§ë¨ )",
		             search: "",
		             zeroRecords: "ì¼ì¹˜í•˜ëŠ” ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.",
		             loadingRecords: "ë¡œë”©ì¤‘...",
		             processing: "ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.",
		             paginate: {
		               next: "ë‹¤ìŒ",
		               previous: "ì´ì „",
		             },
		           },
		         
		     });
		  
	  });
}

function saveMemo(mode, memoNo) {
	const memoTextArea = document.querySelector("#memoTextArea");
	const memoContent = memoTextArea.value;
	
	const memoVO = {
	  memberId,
	  memoContent,
	};
	
	if (mode == 'update') {
		memoVO.memoNo = memoNo;
		
		axios
		  .post("/member/updateMemo", memoVO)
		  .then((res) => {
			  //ì €ì¥ì™„ë£Œ
			  Swal.fire({
				  position: 'top-end',
				  icon: 'success',
				  title: 'ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.',
				  showConfirmButton: false,
				  timer: 1500
				});
		  });
		
		return;
	}
	
	
	axios
	  .post("/member/insertMemo", memoVO)
	  .then((res) => {
		  memoTextArea.value = "";
		  Swal.fire({
			  position: 'top-end',
			  icon: 'success',
			  title: 'ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.',
			  showConfirmButton: false,
			  timer: 1500
			});
	  });
	
}

function memoDelete(memoNo) {
	const memoVO = {
	  memoNo,
	};
	
	axios
	  .post("/member/deleteMemo", memoVO)
	  .then((res) => {
		  memoListRender();
		  memoListRender(); //ã…‹ã…‹ë‘ë²ˆí•´ë²„ë¦¬ê¸°
		  
		  Swal.fire({
              position: 'top-end',
              icon: 'success',
              title: 'ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.',
              showConfirmButton: false,
              timer: 1500
            });
	  });
}

/* ìª½ì§€ cnt ì—…ë°ì´íŠ¸ */
function checkletterCnt(){
	var memberId = localStorage.getItem('id');
	var letterVO = {
		memberId : memberId
	}
	$.ajax({
		url : "/letter/mylist",
		type : "post",
		data : JSON.stringify(letterVO),
		contentType : 'application/json; charset=utf-8',
		dataType : 'json',
		success : function(res) {
			var checkCnt = 0;
			console.log(res)
			for (var i = 0; i < res.length; i++) {
				if (res[i].letterCheck =='0' && res[i].letterDelstate == '0') {
					checkCnt += 1;
				}
			}
			console.log("ì•ˆì½ì€í¸ì§€:"+checkCnt);
			$('.chkletterinit').text(checkCnt)
			
		},
	});//ajax
}

</script>